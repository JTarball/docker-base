#
# Circle CI
# 
# For running docker images on circle ci, see: https://circleci.com/docs/docker
# For circle.yml explanation, see: https://circleci.com/docs/manually
# Python specific configuration, see: https://circleci.com/docs/language-python
#

machine:
    services:
        - docker

dependencies:
    pre:
        - docker info
        - sudo pip install docker-compose
        - git clone https://github.com/docker-library/official-images.git ~/official-images

test:
  override:
        # Need to generate support for onbuild commands
        - mkdir requirements
        - mkdir app
        - touch requirements/prod.txt
        - touch docker-entrypoint.sh
        - chmod a+x docker-entrypoint.sh
        - docker build -t "jtarball/docker-base:latest" .
        # Copy all tests into official folder and combine configs
        - sudo cp -r tests/* ~/official-images/test/tests
        - mv ./config.sh ~/official-images/test/config.sh
        # - ~/official-images/test/run.sh "jtarball/docker-base:latest"
        - ~/official-images/test/run.sh --config ~/official-images/test/config.sh --config ./my-config.sh "jtarball/docker-base:latest"